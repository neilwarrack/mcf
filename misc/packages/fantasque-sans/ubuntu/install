#!/usr/bin/env python3
# encoding: utf-8

import locale
import argparse
import subprocess

from git_repository import GitRepository


def install():
    with GitRepository('belluzj/fantasque-sans') as repo:
        # Completely remove line with ttf2eot command
        _replace('s/^\tttf2eot.*$//', 'Makefile')
        _replace('s/\.fonts/\.mcf\/\.fonts/', 'Makefile')
        # Make install
        subprocess.call(['make', 'install'])


def is_installed():
    enc = locale.getdefaultlocale()[1]
    fonts = subprocess.check_output(['fc-list']).decode(enc)
    return fonts.find('FantasqueSans') != -1


def _replace(e, f):
    cmd = ['sed', '-i', '-e', e, f]
    subprocess.call(cmd)


if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='''
    Install Fantasque Sans font from source.
    ''', formatter_class=argparse.RawDescriptionHelpFormatter)
    parser.add_argument('--reinstall', action='store_true',
                        help='reinstall if the font is already installed')
    args = parser.parse_args()
    if not args.reinstall and is_installed():
        print('FantasqueSans is already installed. '
              'Pass --reinstall to force reinstallation.')
    else:
        install()
